<%- include('../partials/header') %>

<!-- 1. 달력(flatpickr) 라이브러리 CSS와 JS를 불러옵니다. -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<div class="page-title-section">
    <h1 class="page-title">시합 일정</h1>
</div>

<div class="content-wrapper container">
    <% if (user) { %>
        <div style="text-align: right; margin-bottom: 2rem;">
            <button class="btn" onclick="toggleForm()">일정 등록</button>
        </div>
        <div id="scheduleForm" class="form-container" style="max-width: none; margin-bottom: 3rem; display: none;">
            <h3>신규 시합 일정 등록</h3>
            <form action="/schedule/add" method="POST">
                <div class="form-group">
                    <label for="title">시합명 / 일정 제목</label>
                    <input type="text" name="title" required>
                </div>
                <div class="form-group">
                    <label for="event_date">날짜</label>
                    <!-- 2. 날짜 입력을 위한 input 요소 -->
                    <input type="text" id="datepicker" name="event_date" placeholder="날짜를 선택하세요..." required>
                </div>
                <div class="form-group">
                    <label for="event_time">시간</label>
                    <!-- 3. 시간 입력을 위한 input 요소 -->
                    <input type="text" id="timepicker" name="event_time" placeholder="시간을 선택하세요...">
                </div>
                <div class="form-group">
                    <label for="location">장소</label>
                    <input type="text" name="location">
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn">등록하기</button>
                </div>
            </form>
        </div>
    <% } %>

    <div class="schedule-list-page">
        <% schedules.forEach(item => { %>
            <div class="schedule-item" style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3><%= item.title %></h3>
                    <p><strong>날짜:</strong> <%= item.event_date %> | <strong>시간:</strong> <%= item.event_time || '미정' %> | <strong>장소:</strong> <%= item.location || '미정' %></p>
                    <p class="meta"><strong>등록자:</strong> <%= item.author_nickname %> | <strong>등록일:</strong> <%= new Date(item.createdAt).toLocaleDateString() %></p>
                </div>
                <% if (user && (user.isAdmin || user.id === item.author_id)) { %>
                    <form action="/schedule/delete/<%= item.id %>" method="POST">
                        <button type="submit" class="btn btn-delete">삭제</button>
                    </form>
                <% } %>
            </div>
        <% }) %>
    </div>
</div>

<script>
    // 4. 페이지가 완전히 로드된 후, 달력과 시계 기능을 실행합니다.
    document.addEventListener('DOMContentLoaded', function() {
        // 날짜 선택기 (달력)
        flatpickr("#datepicker", {
            dateFormat: "Y-m-d", // 날짜 형식: 2025-08-08
        });

        // 시간 선택기 (시계)
        flatpickr("#timepicker", {
            enableTime: true,    // 시간 선택 활성화
            noCalendar: true,    // 달력은 숨김
            dateFormat: "H:i",   // 시간 형식: 14:30 (24시간제)
            time_24hr: true
        });
    });

    function toggleForm() {
        const form = document.getElementById('scheduleForm');
        if (form.style.display === 'none') {
            form.style.display = 'block';
        } else {
            form.style.display = 'none';
        }
    }
</script>

<%- include('../partials/footer') %>
